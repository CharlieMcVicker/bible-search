{% extends "base.html" %} {% block title %}Search Results - Cherokee Search{%
endblock %} {% block content %}
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Results for "{{ query }}"</h2>
      <!-- Refinement Form -->
      <form
        action="{{ url_for('search_page') }}"
        method="GET"
        class="d-flex align-items-center gap-2"
      >
        <input type="hidden" name="q" value="{{ query }}" />

        <div class="form-check form-switch mb-0">
          <input
            class="form-check-input"
            type="checkbox"
            id="useLemmaRefine"
            name="use_lemma"
            {%
            if
            use_lemma
            %}checked{%
            endif
            %}
            onchange="this.form.submit()"
          />
          <label class="form-check-label text-nowrap" for="useLemmaRefine"
            >Roots</label
          >
        </div>

        <div class="form-check form-switch mb-0">
          <input
            class="form-check-input"
            type="checkbox"
            id="isHypotheticalRefine"
            name="is_hypothetical"
            {%
            if
            is_hypothetical
            %}checked{%
            endif
            %}
            onchange="this.form.submit()"
          />
          <label class="form-check-label text-nowrap" for="isHypotheticalRefine"
            >Hypothetical</label
          >
        </div>

        <div class="form-check form-switch mb-0">
          <input
            class="form-check-input"
            type="checkbox"
            id="isCommandRefine"
            name="is_command"
            {%
            if
            is_command
            %}checked{%
            endif
            %}
            onchange="this.form.submit()"
          />
          <label class="form-check-label text-nowrap" for="isCommandRefine"
            >Imperative</label
          >
        </div>

        <div class="input-group input-group-sm me-2">
          <span class="input-group-text">Sort</span>
          <select class="form-select" name="sort" onchange="this.form.submit()">
            <option value="rank" {{ 'selected' if sort == 'rank' else '' }}>Relevance</option>
            <option value="length_asc" {{ 'selected' if sort == 'length_asc' else '' }}>Shortest</option>
            <option value="length_desc" {{ 'selected' if sort == 'length_desc' else '' }}>Longest</option>
          </select>
        </div>

        <div class="dropdown me-2">
          <button
            class="btn btn-sm btn-outline-secondary dropdown-toggle"
            type="button"
            id="subclauseDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            Subclauses {% if selected_subclauses %}
            <span class="badge bg-primary"
              >{{ selected_subclauses|length }}</span
            >
            {% endif %}
          </button>
          <div
            class="dropdown-menu p-3"
            aria-labelledby="subclauseDropdown"
            style="min-width: 250px"
          >
            {% for dep, label in subclause_labels.items() %}
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                name="subclause_types"
                value="{{ dep }}"
                id="sub_{{ dep }}"
                {%
                if
                dep
                in
                selected_subclauses
                %}checked{%
                endif
                %}
                onchange="this.form.submit()"
              />
              <label class="form-check-label" for="sub_{{ dep }}">
                {{ label }}
              </label>
            </div>
            {% endfor %} {% if selected_subclauses %}
            <hr class="dropdown-divider" />
            <a
              href="{{ url_for('search_page', q=query, use_lemma='on' if use_lemma else None, sort=sort, is_hypothetical='on' if is_hypothetical else None, is_command='on' if is_command else None) }}"
              class="btn btn-sm btn-link text-danger p-0"
              >Clear Subclauses</a
            >
            {% endif %}
          </div>
        </div>

        <button class="btn btn-sm btn-primary" type="submit">
          Apply
        </button>
      </form>
    </div>

    {% if sentences %}
    <p class="text-muted">
      Found {{ count }} result(s) on page {{ page }}. {% if use_lemma %}<span
        class="badge bg-info text-dark"
        >Lemma Search</span
      >{% endif %}
    </p>

    <div class="list-group mb-4">
      {% for sentence in sentences %}
      <div class="list-group-item list-group-item-action">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">{{ sentence.syllabary }}</h5>
          <small class="text-muted">{{ sentence.ref_id }}</small>
        </div>

        <div class="row">
          <div class="col-md-6 border-end">
            <p class="mb-1 fw-bold">{{ sentence.phonetic }}</p>
            <p class="mb-1">{{ sentence.english }}</p>
            {% if sentence.subclause_types %}
            <div class="mt-2">
              {% for stype in sentence.subclause_types.split(',') %}
              <span class="badge bg-light text-dark border">{{ subclause_labels.get(stype, stype) }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          <div class="col-md-6 ps-4 d-flex align-items-center">
            {% if sentence.audio %}
            <audio
              controls
              src="{{ url_for('static', filename='audio/' + sentence.audio) }}"
            ></audio>
            {% else %}
            <span class="text-muted fst-italic">No audio</span>
            {% endif %}
          </div>
        </div>

        {% if sentence.lemma_text and use_lemma %}
        <small class="text-muted">Lemma: {{ sentence.lemma_text }}</small>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <nav aria-label="Search results pages">
      <ul class="pagination justify-content-center">
        {% if page > 1 %}
        <li class="page-item">
          <a
            class="page-link"
            href="{{ url_for('search_page', q=query, page=page-1, use_lemma='on' if use_lemma else None, sort=sort, is_hypothetical='on' if is_hypothetical else None, is_command='on' if is_command else None, subclause_types=selected_subclauses) }}"
            >Previous</a
          >
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Previous</span>
        </li>
        {% endif %}

        <li class="page-item active" aria-current="page">
          <span class="page-link">{{ page }}</span>
        </li>

        {% if sentences|length == per_page %}
        <li class="page-item">
          <a
            class="page-link"
            href="{{ url_for('search_page', q=query, page=page+1, use_lemma='on' if use_lemma else None, sort=sort, is_hypothetical='on' if is_hypothetical else None, is_command='on' if is_command else None, subclause_types=selected_subclauses) }}"
            >Next</a
          >
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Next</span>
        </li>
        {% endif %}
      </ul>
    </nav>

    {% else %}
    <div class="alert alert-info">No results found for "{{ query }}".</div>
    {% endif %}
  </div>
</div>
{% endblock %}
